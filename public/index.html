<!DOCTYPE html>
<html>
    <head>
        <meta charset="'utf-8">
        <meta name="'viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <title>WesCourse</title>

        <script src="https://use.fontawesome.com/b6a42b064c.js"></script>
        

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
        <script src='jquery-3.2.1.min.js'></script>
    </head>

    <body>

        <button class='trigger'>CLICK!</button>

        <div class="cont" style="position: relative;"></div>
        
    </body>

</html>

<script>

function templateRender(data) {
    let template = '<div class="categories" style="border-radius: 0px;transform: translate(5%);">';
    let keys = Object.keys(data);
    let tmp;
    for (let i = 0; i < keys.length; ++i) {
        template +=`<button style="border-radius: 0px" class="btn btn-danger" type="button" data-toggle="collapse" data-target="#collapse${i}" aria-expanded="false" aria-controls="collapse${i}">
                        ${keys[i]}
                    </button>`;
    }
    template += '</div>';

    for (let j = 0; j < keys.length; ++j) {
        data[keys[j]].forEach(function(name,index) {
            if (index === 0) {
                template += `<div style="border-radius: 0px;" class="collapse" id="collapse${j}">
                                <div class="card card-block bg-danger">
                                <div style="color: black;padding: 10px;">
                                    <i class="fa fa-book fa-3x" aria-hidden="false"></i>
                                    <h1 style="display: inline-block;">${keys[j]}</h1>
                                </div>
                                    <div class=row>`;
            };

            if (index%10 === 0) {
                template += `<div class=col-4>`;
                tmp = index+9;
            };

            template += `<div class="row">
                            <i style="padding-top: 1%;margin-right: 1%;" class="fa fa-chevron-circle-right" aria-hidden="true"></i>
                            <a style='color: black;display: inline-block;' href='/${name}'><strong>${name}</strong></a>
                        </div>`;

            if (index === tmp) {
                template += `</div>`;
            }

            if (index === data[keys[j]].length-1) {
                if (index < tmp) {
                    template += `</div>
                        </div>
                    </div>
                </div>`
                } else {
                    template += `</div>
                            </div>
                        </div>`
                
                };
            }
        });
    }
        
    return template;
};

// Catalog Trigger Event Listener
$('.trigger').on('click',function () {
    $.ajax({
        url: '/catalog',
        success: function (data) {
            let contQuery = $('.cont');
            if (contQuery.html() !== '') return;
            let template = templateRender(data);
            contQuery.append(template);

            let buttonsQuery = $('button[data-toggle="collapse"]');

            buttonsQuery.each(function (i,elem) {
                $(`button[data-target="#collapse${i}"]`).attr('class','btn btn-outline-danger');
            });

            buttonsQuery.on('click' ,function (e) {
                buttonsQuery.each(function(i,elem) {
                    if (e.currentTarget.dataset.target === `#collapse${i}`) {
                        $(`button[data-target="#collapse${i}"]`).blur();
                        if (!$(`#collapse${i}`).find('hr').length) {
                                $(`#collapse${i}`).append(`<hr/>`);
                        }

                        if ($(`button[data-target="#collapse${i}"]`).attr('aria-expanded') === 'true') {
                            $(`button[data-target="#collapse${i}"]`).attr('class','btn btn-outline-danger');
                        } else {
                            $(`button[data-target="#collapse${i}"]`).attr('class','btn btn-danger');
                        }
                    } 

                });
                
            });


        }
    });
});

// Catalog Button Switch Event Listener



</script>